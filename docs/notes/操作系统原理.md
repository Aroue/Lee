# 操作系统

## 一、操作系统基本特征

### 1. 并发（Concurrence）

系统中的程序能够并发执行这一特征，使得 OS 能有效地提高系统中资源的利用率，增加系统的吞吐量。

#### 1.1  并发与并行

并行性：指两个或者多个事件在`同一时刻`发生

并发性：指两个或多个事件在`同一时间间隔内`发生

#### 1.2  引入进程



### 2. 共享（Sharing）



#### 2.1  互斥共享方式





#### 2.2  互斥共享方式



### 3. 虚拟



#### 3.1  时分复用技术



#### 3.2  空分复用技术



## 二、进程与线程
### 1.  进程与线程

#### 1)  进程的概念

进程是指一个具有`独立功能`的程序在一个`数据集合`上的一次`动态执行`过程。



进程是资源分配的基本单位。



PCB：进程控制快（Process Control Block，PCB）是系统用来描述进程的基本情况和活动过程，进而控制和管理进程。

程序段、相关数据段和 PCB 三部分构成进程实体，简称进程。对进程的操作实质上是对 PCB 的操作。

#### 2)  线程的概念

线程是独立调度和分派的基本单位。



一个进程中可以有多个线程，它们共享该进程中的全部系统资源。

同一进程或不同进程的中的多个线程可以并发执行。

#### 3)   线程与进程的比较

1⃣️  拥有资源

进程是资源分配的基本单位，但是线程本身不拥有系统资源，但是可以共享该进程所拥有的资源。

2⃣️  调度

线程是调度的基本单位，同一进程中线程的切换不会引起进程的切换，非同一个进程中的线程之间切换会引起进程的切换。

3⃣️  独立性

同一进程中的线程之间的独立性 <<  不同进程之间的独立性

4⃣️  系统开销

进程的创建或撤消时，系统都要为之分配或回收进程控制块、分配或回收它的资源（内存空间、I/O设备），所付出的开销远远大于创建或撤消线程的开销；在进程切换时，涉及进程上下文的切换，而线程的切换代价远远小于进程的切换。

#### 4)  进程状态的切换

进程的三种基本状态：

就绪：进程已经处于准备运行的状态，即进程已经分配到处 CPU 之外的所有必要资源，再获得 CPU 之后便可以执行。

执行：进程已获得 CPU ，其程序处于执行状态。

堵塞：是指正在运行的进程由于发生某事件 (I/O请求、申请缓冲区失败等) 暂时无法继续执行时的状态，即进程的执行受到阻塞。

此外还有创建创建状态和终止状态



⚠️只有就绪状态能转化为执行状态



![进程状态转换图](/Users/klee/Documents/Lee/docs/_media/images/status-change.png)

### 2.  调度算法

## 三、死锁

#### 1.  死锁定义

如果一组进程中的每一个进程都在等待仅由该组进程中的其他进程才能引发的事件，那么该组进程就是死锁 (Deadlock) 的。

#### 2.  产生死锁的必要条件

- 互斥：每个资源要么已经分配给了一个进程，要么就是可用的。
- 占有和等待：已经得到了某个资源的进程可以再请求新的资源。
- 不可抢占：已经分配给一个进程的资源不能强制性地被抢占，它只能被占有它的进程显式地释放。
- 环路等待：有两个或者两个以上的进程组成一条环路，该环路中的每个进程都在等待下一个进程所占有的资源。










## 五、磁盘调度

例:假定某磁盘共有200个柱面，编号为0-199，如果在为访问143号柱面的请求者服务后，当前正在为访问125号柱面的请求服务，同时有若干请求者在等待服务，它们每次要访问的柱面号为   86，147，91，177，94，150，102，175，130

 

**1、先来先服务算法（FCFS）First Come First Service**

这是一种比较简单的磁盘调度算法。它根据进程请求访问磁盘的先后次序进行调度。此算法的优点是公平、简单，且每个进程的请求都能依次得到处理，不会出现某一进程的请求长期得不到满足的情况。此算法由于未对寻道进行优化，在对磁盘的访问请求比较多的情况下，此算法将降低设备服务的吞吐量，致使平均寻道时间可能较长，但各进程得到服务的响应时间的变化幅度较小。

先来先服务（125）86.147.91.177.94.150.102.175.130

 

**2、最短寻道时间优先算法（SSTF） Shortest Seek Time First**

该算法选择这样的进程，其要求访问的磁道与当前磁头所在的磁道距离最近，以使每次的寻道时间最短，该算法可以得到比较好的吞吐量，但却不能保证平均寻道时间最短。其缺点是对用户的服务请求的响应机会不是均等的，因而导致响应时间的变化幅度很大。在服务请求很多的情况下，对内外边缘磁道的请求将会无限期的被延迟，有些请求的响应时间将不可预期。

最短寻道时间优先（125）130.147.150.175.177.102.94.91.86

 

**3、扫描算法（SCAN）电梯调度**

扫描算法不仅考虑到欲访问的磁道与当前磁道的距离，更优先考虑的是磁头的当前移动方向。例如，当磁头正在自里向外移动时，扫描算法所选择的下一个访问对象应是其欲访问的磁道既在当前磁道之外，又是距离最近的。这样自里向外地访问，直到再无更外的磁道需要访问才将磁臂换向，自外向里移动。这时，同样也是每次选择这样的进程来调度，即其要访问的磁道，在当前磁道之内，从而避免了饥饿现象的出现。由于这种算法中磁头移动的规律颇似电梯的运行，故又称为电梯调度算法。此算法基本上克服了最短寻道时间优先算法的服务集中于中间磁道和响应时间变化比较大的缺点，而具有最短寻道时间优先算法的优点即吞吐量较大，平均响应时间较小，但由于是摆动式的扫描方法，两侧磁道被访问的频率仍低于中间磁道。

电梯调度（125）102.94.91.86.130.147.150.175.177

 

**4、循环扫描算法（CSCAN）**

循环扫描算法是对扫描算法的改进。如果对磁道的访问请求是均匀分布的，当磁头到达磁盘的一端，并反向运动时落在磁头之后的访问请求相对较少。这是由于这些磁道刚被处理，而磁盘另一端的请求密度相当高，且这些访问请求等待的时间较长，为了解决这种情况，**循环扫描算法规定磁头单向移动**。例如，只自里向外移动，当磁头移到最外的被访问磁道时，磁头立即返回到最里的欲访磁道，即将最小磁道号紧接着最大磁道号构成循环，进行扫描。

循环扫描 （125）130.147.150.175.177.86.91.94.102